import{G as f,M as w}from"./vendor-CUhUAKZ9.js";function b(o){let n="";const t=o.byteLength;for(let e=0;e<t;e++)n+=String.fromCharCode(o[e]);return btoa(n)}function A(o){const n=o.length,t=new Int16Array(n);for(let e=0;e<n;e++)t[e]=o[e]*32768;return{data:b(new Uint8Array(t.buffer)),mimeType:"audio/pcm;rate=16000"}}const y=o=>new Promise((n,t)=>{const e=new FileReader;e.onloadend=()=>{const i=e.result.split(",")[1];i?n(i):t(new Error("Failed to convert blob to base64."))},e.onerror=i=>t(i),e.readAsDataURL(o)}),g="";throw new Error("Configura VITE_GEMINI_API_KEY en tu archivo .env para usar Gemini.");const u=new f({apiKey:g}),C=async(o,n)=>{try{const t={inlineData:{data:o,mimeType:n}};return(await u.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[t,{text:"Transcribe este audio."}]}})).text}catch(t){return console.error("Error transcribing audio:",t),""}};let a=null,r=null,s=null,c=null;const I=async({onMessage:o,onError:n,onClose:t,stream:e})=>{a&&(console.warn("An active session already exists. Closing the old one."),v(Promise.resolve(a))),r=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});const i=u.live.connect({model:"gemini-2.5-flash-native-audio-preview-09-2025",callbacks:{onopen:()=>{c=r.createMediaStreamSource(e),s=r.createScriptProcessor(4096,1,1),s.onaudioprocess=d=>{const p=d.inputBuffer.getChannelData(0),m=A(p);i.then(l=>{l&&l.sendRealtimeInput({media:m})})},c.connect(s),s.connect(r.destination)},onmessage:o,onerror:n,onclose:t},config:{responseModalities:[w.AUDIO],outputAudioTranscription:{},inputAudioTranscription:{},systemInstruction:"Eres un asistente de IA para personal escolar. SÃ© conciso, profesional y servicial."}});return a=await i,a},v=o=>{o.then(n=>{n&&n.close(),s&&(s.disconnect(),s=null),c&&(c.disconnect(),c=null),r&&r.state!=="closed"&&(r.close(),r=null),a=null})};export{y as b,v as c,I as s,C as t};
