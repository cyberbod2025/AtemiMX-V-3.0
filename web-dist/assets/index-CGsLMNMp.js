const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AdminPanel-sTlNnyx-.js","./react-vendor-BfikQoQB.js","./vendor-CUhUAKZ9.js","./userService-QFZnPS6u.js","./firebase-Bi_eiI5S.js","./Sase310Module-YSZQ3D9o.js","./firestoreService-DX6OHf6Y.js","./Sidebar-CxeLwP5y.js","./AtemiDashboard-BNj4r2iA.js","./GlobalMenuModal-DolNhYuY.js","./PinPreferencesModal-DDNwYV8g.js","./SecurityPinScreen-CeaOoImb.js","./IdeaIntro-ZEzejWem.js"])))=>i.map(i=>d[i]);
import{r,j as e,G as w,d as Ee}from"./react-vendor-BfikQoQB.js";import{A as Se,m as we}from"./vendor-CUhUAKZ9.js";import{g as _e,a as ye,i as xe,b as be,c as Ae,d as Ie,o as Pe,e as ve,s as je,F as X,f as Re,h as Le,j as Ne,k as Te,l as Oe}from"./firebase-Bi_eiI5S.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();const De=""+new URL("atemi-startup-Ch2NV5O7.mp3",import.meta.url).href,Ce=1.5,ke=.35,Ve=.12,Me=1e3;function Be(){const[t,n]=r.useState(()=>Date.now()),a=r.useRef(null);r.useEffect(()=>{if(typeof Audio>"u")return;const s=new Audio(De);return a.current=s,()=>{s.pause(),a.current=null}},[]);const l=r.useCallback(()=>{const s=a.current;if(!s)return;s.pause(),s.currentTime=0,s.volume=ke;const o=s.play();typeof(o==null?void 0:o.then)=="function"&&o.then(()=>{window.setTimeout(()=>{s.paused||(s.volume=Ve)},Me)}).catch(()=>{})},[]);return r.useEffect(()=>{if(typeof document>"u")return;const s=new MutationObserver(()=>{n(Date.now()),l()});return s.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>s.disconnect()},[l]),e.jsx(Se,{children:e.jsx(we.div,{className:"role-glow",initial:{opacity:0,scale:1.05},animate:{opacity:.35,scale:1},exit:{opacity:0,scale:1},transition:{duration:Ce,ease:"easeInOut"}},t)})}function Fe(){return e.jsxs("div",{className:"atemi-bg","aria-hidden":"true",children:[e.jsx("div",{className:"atemi-layer atemi-gradient"}),e.jsx("div",{className:"atemi-layer atemi-lines"}),e.jsx("div",{className:"atemi-overlay"})]})}const Ue="modulepreload",ze=function(t,n){return new URL(t,n).href},K={},_=function(n,a,l){let s=Promise.resolve();if(a&&a.length>0){let c=function(i){return Promise.all(i.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const u=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),f=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));s=c(a.map(i=>{if(i=ze(i,l),i in K)return;K[i]=!0;const h=i.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(!!l)for(let S=u.length-1;S>=0;S--){const g=u[S];if(g.href===i&&(!h||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${m}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":Ue,h||(p.as="script"),p.crossOrigin="",p.href=i,f&&p.setAttribute("nonce",f),document.head.appendChild(p),h)return new Promise((S,g)=>{p.addEventListener("load",S),p.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${i}`)))})}))}function o(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return s.then(c=>{for(const u of c||[])u.status==="rejected"&&o(u.reason);return n().catch(o)})},He={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyDPunF6Pj8gEm7QNl-5-gXDzsLiaoNO5kM",VITE_FIREBASE_APP_ID:"1:599375908983:web:b28b69a3770c0947063672",VITE_FIREBASE_AUTH_DOMAIN:"atemimx.firebaseapp.com",VITE_FIREBASE_CONFIG:'{"apiKey":"AIzaSyDPunF6Pj8gEm7QNl-5-gXDzsLiaoNO5kM","authDomain":"atemimx.firebaseapp.com","projectId":"atemimx","storageBucket":"atemimx.firebasestorage.app","messagingSenderId":"599375908983","appId":"1:599375908983:web:b28b69a3770c0947063672"}',VITE_FIREBASE_FUNCTIONS_REGION:"us-central1",VITE_FIREBASE_MESSAGING_SENDER_ID:"599375908983",VITE_FIREBASE_PROJECT_ID:"atemimx",VITE_FIREBASE_STORAGE_BUCKET:"atemimx.firebasestorage.app",VITE_GEMINI_API_KEY:""},y=t=>{const n=He[t];if(!n)throw new Error(`Missing required environment variable: ${t}`);return n},Ge={apiKey:y("VITE_FIREBASE_API_KEY"),authDomain:y("VITE_FIREBASE_AUTH_DOMAIN"),projectId:y("VITE_FIREBASE_PROJECT_ID"),storageBucket:y("VITE_FIREBASE_STORAGE_BUCKET"),messagingSenderId:y("VITE_FIREBASE_MESSAGING_SENDER_ID"),appId:y("VITE_FIREBASE_APP_ID")},B=_e().length?ye():xe(Ge),A=be(B),It=Ae(B),qe="us-central1",Pt=Ie(B,qe),Ke="rol-";function b(t){if(typeof document>"u")return;const n=document.body;n.className="",n.classList.add(`${Ke}${t}`)}const $=r.createContext(void 0),We={admin:"direccion",direccion:"direccion",director:"direccion",docentes:"docentes",docente:"docentes",teacher:"docentes",profesor:"docentes",profesora:"docentes",prefecto:"prefectura",prefecta:"prefectura",prefect:"prefectura",prefectura:"prefectura",orientacion:"orientacion",orientadora:"orientacion",orientador:"orientacion",guidance:"orientacion",trabajo_social:"tsocial",socialwork:"tsocial",tsocial:"tsocial",social:"tsocial",medical:"enfermeria",medico:"enfermeria",medica:"enfermeria",enfermeria:"enfermeria"},Xe=t=>{if(typeof t!="string")return"none";const n=t.trim().toLowerCase();return We[n]??"none"};function $e(){const[t,n]=r.useState(A.currentUser),[a,l]=r.useState(()=>A.currentUser===null),[s,o]=r.useState(!1),[c,u]=r.useState(null),[E,f]=r.useState("none"),[i,h]=r.useState(null);return r.useEffect(()=>{b("none")},[]),r.useEffect(()=>{let m=!0;const x=Pe(A,async p=>{if(m){if(n(p),!p){u(null),f("none"),b("none"),h(null),l(!1),o(!1);return}l(!1),o(!0);try{const S=await ve(p,!0),g=typeof S.claims.role=="string"?S.claims.role:null,I=Xe(g);u(g),f(I),b(I),h(null)}catch(S){console.error("[Auth] No fue posible recuperar los claims del usuario",S),u(null),f("none"),b("none"),h("No pudimos recuperar tus permisos. Intenta volver a iniciar sesiÃ³n.")}finally{o(!1)}}});return()=>{m=!1,x(),b("none")}},[]),r.useMemo(()=>({user:t,loading:a,claimsLoading:s,role:c,visualRole:E,claimsError:i}),[t,a,s,c,E,i])}const Ye=({children:t})=>{const n=$e();return e.jsx($.Provider,{value:n,children:t})},Qe=()=>{const t=r.useContext($);if(!t)throw new Error("useAuthContext debe usarse dentro de un AuthProvider");return t},Je=()=>{const{user:t,loading:n,claimsLoading:a,role:l,visualRole:s,claimsError:o}=Qe();return r.useMemo(()=>({user:t,loading:n||a,authLoading:n,claimsLoading:a,role:l,visualRole:s,claimsError:o}),[t,n,a,l,s,o])},Y=(t,n)=>{if(n instanceof X){console.error(`[Auth] ${t} (code: ${n.code})`);return}console.error(`[Auth] ${t}:`,n)},Ze=je(A,Le).catch(t=>{throw Y("Failed to set persistence",t),t}),et=t=>{if(t instanceof X)switch(t.code){case"auth/email-already-in-use":return"El correo electronico ya esta registrado.";case"auth/invalid-email":return"El formato del correo electronico no es valido.";case"auth/weak-password":return"La contrasena debe cumplir con los requisitos minimos de seguridad.";case"auth/user-not-found":case"auth/invalid-credential":return"Las credenciales ingresadas son incorrectas.";case"auth/wrong-password":return"La contrasena es incorrecta.";case"auth/too-many-requests":return"Se detectaron multiples intentos fallidos. Intenta mas tarde.";case"auth/network-request-failed":return"No se pudo establecer conexion con el servicio de autenticacion.";case"auth/configuration-not-found":return"La configuracion de autenticacion no esta disponible. Verifica las credenciales de Firebase.";case"auth/internal-error":return"El servicio de autenticacion respondio con un error interno. Intenta nuevamente.";default:return"Ocurrio un error al procesar la solicitud de autenticacion."}return"Error inesperado de autenticacion."},N=async t=>{try{return await Ze,await t(A)}catch(n){throw Y("Operation failed",n),new Error(et(n))}},vt=async(t,n)=>N(async a=>(await Re(a,t,n)).user),jt=async(t,n)=>N(async a=>(await Ne(a,t,n)).user),tt=async()=>{await N(async t=>{await Te(t)})},Rt=async t=>{await N(async n=>{await Oe(n,t)})};class nt extends w.Component{constructor(){super(...arguments),this.state={hasError:!1},this.handleReset=()=>{this.setState({hasError:!1,error:void 0})}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){console.error("[UI] Unhandled rendering error:",n,a)}render(){var n;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{className:"error-fallback",children:[e.jsx("h2",{children:"OcurriÃ³ un problema."}),e.jsx("p",{children:((n=this.state.error)==null?void 0:n.message)??"La interfaz no pudo renderizarse correctamente."}),e.jsx("button",{type:"button",onClick:this.handleReset,children:"Reintentar"})]}):this.props.children}}const rt=w.lazy(()=>_(()=>import("./AdminPanel-sTlNnyx-.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),st=w.lazy(()=>_(()=>import("./Sase310Module-YSZQ3D9o.js"),__vite__mapDeps([5,1,2,4,3,6]),import.meta.url)),ot=w.lazy(()=>_(()=>import("./Sidebar-CxeLwP5y.js"),__vite__mapDeps([7,1,2]),import.meta.url)),at=w.lazy(()=>_(()=>import("./AtemiDashboard-BNj4r2iA.js").then(t=>t.y),__vite__mapDeps([8,1,2]),import.meta.url)),it=w.lazy(()=>_(()=>import("./GlobalMenuModal-DolNhYuY.js"),__vite__mapDeps([9,1,2]),import.meta.url)),ct=w.lazy(()=>_(()=>import("./PinPreferencesModal-DDNwYV8g.js"),__vite__mapDeps([10,1,2]),import.meta.url)),lt=w.lazy(()=>_(()=>import("./SecurityPinScreen-CeaOoImb.js"),__vite__mapDeps([11,1,2]),import.meta.url)),dt=w.lazy(()=>_(()=>import("./IdeaIntro-ZEzejWem.js"),__vite__mapDeps([12,1,2]),import.meta.url)),ut=()=>"menu",pt=t=>t==="sase310"?"/sase310":t==="admin"?"/sase310/admin":"/",mt=()=>{const{user:t,loading:n,claimsLoading:a,role:l,claimsError:s}=Je(),[o,c]=r.useState(()=>ut()),[u,E]=r.useState(!1),[f,i]=r.useState(null),[h,m]=r.useState(!1),[x,p]=r.useState("unlock"),[S,g]=r.useState(null),[I,P]=r.useState(!1),[Q,J]=r.useState(!0),[Z,ee]=r.useState(!0),[te,v]=r.useState(!1),[ne,T]=r.useState(!1),[F,O]=r.useState(null),[D,C]=r.useState(!1),U=n||a,k="atemi:pinEnabled",V="atemi:pinValue";r.useEffect(()=>{if(!f)return;const d=window.setTimeout(()=>i(null),4e3);return()=>window.clearTimeout(d)},[f]),r.useEffect(()=>{s&&i(s)},[s]),r.useEffect(()=>{if(typeof window>"u")return;const d=window.localStorage.getItem(k)==="true",L=window.localStorage.getItem(V);d&&L&&(T(!0),O(L),C(!0))},[]),r.useEffect(()=>{D&&(p("unlock"),g(null),m(!0))},[D]),r.useEffect(()=>{if(typeof window>"u")return;if(!t){c("menu"),window.location.pathname!=="/"&&window.history.replaceState({},"","/");return}const d=window.location.pathname;if(d.startsWith("/sase310/admin")){c("admin");return}if(d.startsWith("/sase310")){c("sase310");return}c("menu")},[t]),r.useEffect(()=>{if(typeof window>"u")return;const d=pt(o);window.location.pathname!==d&&window.history.replaceState({},"",d)},[o]),r.useEffect(()=>{if(typeof window>"u"||!U)return;const L=window.setTimeout(()=>{i(ge=>ge??"No pudimos confirmar la sesion. Intenta iniciar sesion desde el modulo SASE-310.")},15e3);return()=>window.clearTimeout(L)},[U]),r.useEffect(()=>{!t&&(o==="admin"||o==="sase310")&&c("menu")},[t,o]);const M=r.useMemo(()=>(l??"").toLowerCase()==="admin",[l]),z=o==="menu",j=()=>{c("menu"),typeof window<"u"&&window.history.replaceState({},"","/")},re=()=>{c("menu"),typeof window<"u"&&window.history.replaceState({},"","/")},H=()=>{c("sase310"),typeof window<"u"&&window.history.replaceState({},"","/sase310")},se=()=>{if(!M){i("No cuentas con permisos de administraciÃ¯Â¿Â½n para acceder a esta secciÃ¯Â¿Â½n."),j();return}c("admin"),typeof window<"u"&&window.history.replaceState({},"","/sase310/admin")},oe=()=>{i("Consulta la documentacion AtemiMX o contacta al equipo para asistencia.")},ae=()=>{i("La configuracion personalizada estara disponible proximamente.")},ie=d=>{if(x==="setup"){typeof window<"u"&&(window.localStorage.setItem(V,d),window.localStorage.setItem(k,"true")),O(d),T(!0),g(null),m(!1),p("unlock"),i("PIN configurado correctamente.");return}if(F&&d===F){C(!1),m(!1),g(null);return}g("PIN incorrecto. Intenta nuevamente.")},ce=()=>{typeof window<"u"&&(window.localStorage.removeItem(V),window.localStorage.removeItem(k)),O(null),T(!1),C(!1),v(!1),i("PIN desactivado.")},le=()=>{v(!1),p("setup"),g(null),m(!0)},de=()=>{P(!0)},ue=()=>{J(d=>!d)},pe=()=>{v(!0)},G=async()=>{if(!u)try{E(!0),await tt(),i("Sesion finalizada correctamente.")}catch(d){console.error("[UI] Error al cerrar sesion",d),i("No fue posible cerrar sesion. Intenta nuevamente.")}finally{E(!1),j()}},q=d=>e.jsxs("section",{className:"empty-state",children:[e.jsx("p",{className:"empty-state__eyebrow",children:"AtemiMX"}),e.jsx("h2",{children:d}),e.jsx("p",{children:"Usa el menÃº lateral para abrir mÃ³dulos o lanzar el menÃº flotante."})]}),R=d=>e.jsx("div",{className:"app-shell__loader",role:"status","aria-live":"polite",children:d}),me=()=>o==="none"?q("Elige un mÃ³dulo para comenzar"):o==="admin"?!t||!M?e.jsxs("section",{className:"card",children:[e.jsx("h2",{className:"text-lg font-display text-white",children:"Acceso restringido"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Necesitas permisos de administraciÃ³n para ingresar a este panel."})]}):e.jsx(r.Suspense,{fallback:R("Abriendo panel administrativo..."),children:e.jsx(rt,{})}):o==="sase310"?e.jsx(r.Suspense,{fallback:R("Cargando mÃ³dulo SASE-310..."),children:e.jsx(st,{onNavigateHome:j})}):q("Panel principal disponible desde el menÃº general"),fe=()=>e.jsx("div",{className:"app-shell__layer",children:e.jsxs("div",{className:"app-shell__layout",children:[e.jsx(r.Suspense,{fallback:R("Cargando navegaciÃ³n principal..."),children:e.jsx(ot,{activeView:o,hasSession:!!t,logoutPending:u,onSelectHome:j,onResetView:re,onSelectSase:H,onSelectAdmin:se,onOpenHelp:oe,onOpenSettings:ae,onLogout:G,canAccessAdmin:!!(t&&M),onOpenLauncher:de,onToggleCollapse:ue,isCollapsed:Q})}),e.jsxs("main",{className:"app-shell__main",children:[f?e.jsx("div",{className:"app-shell__notice",children:f}):null,e.jsx(nt,{children:e.jsx("div",{className:"app-shell__content",children:me()})})]})]})}),he=()=>e.jsxs("div",{className:"dashboard-wrapper",children:[f?e.jsx("div",{className:"app-shell__notice dashboard-wrapper__notice",children:f}):null,e.jsx(r.Suspense,{fallback:R("Cargando panel AtemiMX..."),children:e.jsx(at,{user:t,role:l??null,onLogout:G})})]});return e.jsxs("div",{className:`app-shell${z?" app-shell--dashboard":""}`,children:[z?he():fe(),e.jsx(r.Suspense,{fallback:null,children:e.jsx(lt,{open:h,mode:x,errorMessage:S,onCancel:()=>{m(!1),D&&m(!0)},onSubmit:ie})}),e.jsx(r.Suspense,{fallback:null,children:e.jsx(it,{open:I,onClose:()=>P(!1),onOpenSase:()=>{P(!1),H()},onShowSecurity:()=>{P(!1),pe()},variant:"floating",user:t})}),e.jsx(r.Suspense,{fallback:null,children:e.jsx(ct,{open:te,pinEnabled:ne,onRequestSetup:le,onDisable:ce,onClose:()=>v(!1)})}),Z?e.jsx(r.Suspense,{fallback:null,children:e.jsx(dt,{onStart:()=>ee(!1)})}):null]})};function ft(){return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{}),e.jsx(Be,{}),e.jsx(mt,{})]})}const ht=[{label:"Aviso de Privacidad",emoji:"ðŸ“˜",href:"https://docs.google.com/document/d/1fofju9x-kRUH2zU1S9LllmxPiTqQ3HcwbLVCPUhBcNM/edit?usp=sharing"},{label:"TÃ©rminos de Uso",emoji:"âš–ï¸",href:"https://docs.google.com/document/d/1Vo1o8ew31LPTwHrX1y41hklHtowaIQtMEBr0WPDdZHA/edit?usp=drive_link"},{label:"Protocolo Ãngel GuardiÃ¡n",emoji:"ðŸŽ¤",href:"https://docs.google.com/document/d/1XlAIXN__SLEmX-3Dyhjig7RTZu5W3amtSfKkQCWF6uw/edit?usp=drive_link"}],gt={minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"radial-gradient(circle at top, rgba(0, 191, 255, 0.15), transparent 55%)",padding:"24px"},Et={maxWidth:"640px",width:"100%",backgroundColor:"rgba(12, 21, 40, 0.92)",border:"1px solid rgba(0, 191, 255, 0.3)",borderRadius:"18px",padding:"32px",boxShadow:"0 20px 45px rgba(0, 0, 0, 0.35)",color:"#ecf6ff",fontFamily:'"Montserrat","Inter",system-ui,sans-serif'},St={listStyle:"none",padding:0,margin:"20px 0",display:"flex",flexDirection:"column",gap:"12px"},wt={width:"100%",padding:"14px 18px",borderRadius:"999px",border:"none",fontSize:"1rem",fontWeight:600,cursor:"pointer",background:"linear-gradient(120deg, rgba(0, 191, 255, 0.95), rgba(255, 51, 102, 0.95))",color:"#04101f",transition:"opacity 0.2s ease"},_t=({onAccept:t})=>{const[n,a]=r.useState(!1),l=r.useMemo(()=>ht.map(s=>e.jsx("li",{children:e.jsxs("a",{href:s.href,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",alignItems:"center",gap:"10px",textDecoration:"none",color:"#a8e1ff",fontWeight:500},children:[e.jsx("span",{"aria-hidden":"true",role:"img",children:s.emoji}),e.jsx("span",{children:s.label})]})},s.href)),[]);return e.jsx("div",{style:gt,children:e.jsxs("section",{style:Et,"aria-labelledby":"legal-consent-title",children:[e.jsx("h2",{id:"legal-consent-title",style:{fontSize:"1.6rem",marginBottom:"12px"},children:"Condiciones de Uso y Privacidad"}),e.jsxs("p",{style:{color:"#c7d9ec",lineHeight:1.5},children:["Antes de usar AtemiMX, revisa los documentos oficiales del"," ",e.jsx("strong",{children:"Proyecto AtemiMX Â· Piloto Docente 2025â€“2026"}),"."]}),e.jsx("ul",{style:St,children:l}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",marginTop:"10px"},children:[e.jsx("input",{id:"acceptLegal",type:"checkbox",checked:n,onChange:s=>a(s.target.checked)}),e.jsx("span",{children:"He leÃ­do y acepto los documentos anteriores."})]}),e.jsx("button",{id:"continueApp",type:"button",disabled:!n,style:{...wt,marginTop:"24px",opacity:n?1:.4,cursor:n?"pointer":"not-allowed"},onClick:t,children:"Continuar"})]})})},W="atemi:legalConsent:v1",yt=()=>{const[t,n]=r.useState(()=>typeof window>"u"?!0:window.localStorage.getItem(W)==="accepted");return r.useEffect(()=>{t&&typeof window<"u"&&window.localStorage.setItem(W,"accepted")},[t]),t?e.jsx(Ye,{children:e.jsx(ft,{})}):e.jsx(_t,{onAccept:()=>n(!0)})};Ee.createRoot(document.getElementById("root")).render(e.jsx(w.StrictMode,{children:e.jsx(yt,{})}));export{_,A as a,tt as b,vt as c,It as d,Pt as f,jt as l,Rt as r,Je as u};
