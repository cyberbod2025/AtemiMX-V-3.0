import{r,j as e}from"./react-vendor-BmwAAf7d.js";import{c as L,s as S}from"./geminiService-Ce1TecKi.js";import{k as E,l as O,S as T,m as A,n as H}from"./index-B8-JN0Xo.js";import"./vendor-mpNZlVBn.js";import"./firebase-hPZi0YyP.js";const q=()=>{const[s,h]=r.useState(!1),[o,x]=r.useState(!1),[v,b]=r.useState([]),[p,m]=r.useState(""),[f,g]=r.useState(""),i=r.useRef(null),c=r.useRef(""),l=r.useRef(""),k=r.useCallback(t=>{var d,C,y;if((d=t.serverContent)!=null&&d.outputTranscription){const n=t.serverContent.outputTranscription.text;l.current+=n,g(a=>a+n)}else if((C=t.serverContent)!=null&&C.inputTranscription){const n=t.serverContent.inputTranscription.text;c.current+=n,m(a=>a+n)}(y=t.serverContent)!=null&&y.turnComplete&&(b(n=>{const a=[...n],j=c.current,w=l.current;return j.trim()&&a.push({speaker:"user",text:j}),w.trim()&&a.push({speaker:"model",text:w}),a}),c.current="",l.current="",m(""),g(""))},[]),N=t=>{console.error("Live session error:",t),alert("Ocurrió un error en la sesión. La conexión se cerrará."),u()},I=()=>{console.log("Live session closed")},R=async()=>{x(!0),b([]),m(""),g(""),c.current="",l.current="";try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});i.current=S({onMessage:k,onError:N,onClose:I,stream:t}),await i.current,h(!0)}catch(t){console.error("Failed to start conversation:",t),alert("No se pudo iniciar la conversación. Asegúrate de permitir el acceso al micrófono.")}finally{x(!1)}},u=r.useCallback(()=>{(s||o)&&(i.current&&(L(i.current),i.current=null),h(!1),x(!1))},[s,o]);return r.useEffect(()=>()=>{u()},[u]),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-4xl mx-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center mb-4 text-gray-800 dark:text-white",children:[e.jsx(E,{className:"h-7 w-7 mr-3"}),"Asistente Conversacional IA"]}),e.jsx("p",{className:"mb-6 text-gray-600 dark:text-gray-300",children:'Presiona "Iniciar Conversación" para hablar con el asistente en tiempo real. Puedes dictar reportes, pedir resúmenes o consultar información.'}),e.jsx("div",{className:"flex justify-center mb-6",children:s?e.jsxs("button",{onClick:u,className:"flex items-center justify-center bg-red-600 text-white font-semibold px-6 py-3 rounded-full shadow-lg hover:bg-red-700 transition-all duration-200 w-52",children:[e.jsx(T,{className:"h-6 w-6 mr-2"}),"Detener Conversación"]}):e.jsxs("button",{onClick:R,disabled:o,className:"flex items-center justify-center bg-green-600 text-white font-semibold px-6 py-3 rounded-full shadow-lg hover:bg-green-700 transition-all duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed w-52",children:[e.jsx(O,{className:"h-6 w-6 mr-2"}),o?"Conectando...":"Iniciar Conversación"]})}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-900 rounded-lg p-4 min-h-[300px] max-h-[50vh] overflow-y-auto space-y-4",children:[v.length===0&&!s&&e.jsx("div",{className:"flex justify-center items-center h-full text-gray-500",children:"La transcripción aparecerá aquí..."}),v.map((t,d)=>e.jsxs("div",{className:`flex items-start gap-3 ${t.speaker==="user"?"justify-end":""}`,children:[t.speaker==="model"&&e.jsx(A,{className:"h-6 w-6 text-blue-500 flex-shrink-0 mt-1"}),e.jsx("div",{className:`p-3 rounded-lg max-w-lg ${t.speaker==="user"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:t.text}),t.speaker==="user"&&e.jsx(H,{className:"h-6 w-6 text-gray-500 flex-shrink-0 mt-1"})]},d)),s&&p&&e.jsx("div",{className:"text-gray-500 italic",children:p}),s&&f&&e.jsx("div",{className:"text-blue-400 italic",children:f}),s&&!p&&!f&&e.jsx("div",{className:"text-gray-500 italic animate-pulse",children:"Escuchando..."})]})]})};export{q as default};
