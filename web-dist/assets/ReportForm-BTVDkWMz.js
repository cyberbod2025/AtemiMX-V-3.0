import{r as t,j as e,A as N,o as R,u as x,M as T,f as S,R as D}from"./index-CuykJsXK.js";import{b as I,t as C}from"./geminiService-fkZN5fdV.js";const k=({onTranscription:f,disabled:h})=>{const[i,u]=t.useState(!1),[c,m]=t.useState(!1),a=t.useRef(null),l=t.useRef([]),s=t.useRef(null),b=()=>{a.current&&a.current.state==="recording"&&a.current.stop(),s.current&&(s.current.getTracks().forEach(n=>n.stop()),s.current=null),u(!1),m(!0)},p=async()=>{try{const n=await navigator.mediaDevices.getUserMedia({audio:!0});s.current=n;const d=new MediaRecorder(n);a.current=d,l.current=[],d.ondataavailable=r=>{l.current.push(r.data)},d.onstop=async()=>{var v;const r=((v=a.current)==null?void 0:v.mimeType)||"audio/webm",o=new Blob(l.current,{type:r});try{const j=await I(o),w=await C(j,r);f(w)}catch(j){console.error("Transcription failed:",j),alert("No se pudo transcribir el audio.")}finally{m(!1),l.current=[]}},d.start(),u(!0)}catch(n){console.error("Could not start recording:",n),alert("No se pudo acceder al micrófono. Por favor, verifica los permisos.")}},g=()=>{h||c||(i?b():p())},y=i?"text-red-500 animate-pulse":"text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400";return e.jsx("button",{type:"button",onClick:g,disabled:h||c,className:`p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors ${y}`,"aria-label":i?"Detener dictado":"Iniciar dictado",children:c?e.jsx(N,{className:"h-5 w-5 animate-spin"}):e.jsx(R,{className:"h-5 w-5"})})},M=({currentUser:f,onReportSubmit:h})=>{const[i,u]=t.useState(""),[c,m]=t.useState(""),[a,l]=t.useState(x.Disciplinary),[s,b]=t.useState(""),[p,g]=t.useState(""),y=r=>{if(r.preventDefault(),!i||!c||!s||!p){alert("Por favor completa todos los campos.");return}const o={id:`report-${Date.now()}`,studentId:i,teacherId:f.id,date:new Date().toISOString(),type:a,subject:c,description:s,status:D.New,priority:S.Medium,actionsTaken:p,comments:[],evidence:[]};h(o),u(""),m(""),l(x.Disciplinary),b(""),g("")},n=r=>{b(o=>(o?o+" ":"")+r)},d=r=>{g(o=>(o?o+" ":"")+r)};return e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2",children:"Registrar Nueva Incidencia"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"student",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Alumno"}),e.jsxs("select",{id:"student",value:i,onChange:r=>u(r.target.value),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Selecciona un alumno"}),T.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reportType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tipo de Reporte"}),e.jsxs("select",{id:"reportType",value:a,onChange:r=>l(r.target.value),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:x.Disciplinary,children:"Disciplinario"}),e.jsx("option",{value:x.SocioEmotional,children:"Socio-emocional"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Asignatura"}),e.jsx("input",{type:"text",id:"subject",value:c,onChange:r=>m(r.target.value),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Ej. Matemáticas, Historia"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Descripción de la Incidencia"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("textarea",{id:"description",rows:4,value:s,onChange:r=>b(r.target.value),className:"mt-1 block w-full p-2 pr-10 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Describe detalladamente lo que sucedió o usa el micrófono para dictar..."}),e.jsx("div",{className:"absolute top-1 right-0 mt-1 mr-2",children:e.jsx(k,{onTranscription:n})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"actionsTaken",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Acciones Tomadas Inmediatamente"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("textarea",{id:"actionsTaken",rows:2,value:p,onChange:r=>g(r.target.value),className:"mt-1 block w-full p-2 pr-10 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"¿Qué acciones se tomaron en el momento? Puedes dictar..."}),e.jsx("div",{className:"absolute top-1 right-0 mt-1 mr-2",children:e.jsx(k,{onTranscription:d})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-blue-700 transition-colors",children:"Enviar Reporte"})})]})};export{M as R};
