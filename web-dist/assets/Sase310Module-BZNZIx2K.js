import{j as e,C as ss,e as ts,r}from"./react-vendor-BfikQoQB.js";import{f as as,a as Se,u as rs,l as ls,r as ns,b as is}from"./index-CZdUSK2y.js";import{m as os,E as cs,r as ds}from"./firebase-Bi_eiI5S.js";import{o as us,b as ms,s as ve,e as ps,r as xs,R as Ee}from"./userService-ueZSBza3.js";import{g as hs,c as fs,d as bs}from"./firestoreService-CgKjpCo_.js";import"./vendor-CUhUAKZ9.js";const gs="/branding/superio al panel.png",P={key:"general",label:"AtemiMX · SASE-310",image:gs,caption:"Arquitectura S-SDLC"},js={teacher:{key:"teacher",label:"Atem · Docentes",image:"/branding/docentes.png"},admin:{key:"admin",label:"Atem · Dirección",image:"/branding/direccion.png"},guidance:{key:"guidance",label:"Atem · Orientación",image:"/branding/orientacion.png"},socialWork:{key:"socialWork",label:"Atem · Trabajo Social",image:"/branding/t social.png"},prefect:{key:"prefect",label:"Atem · Prefectura",image:"/branding/prefectura.png"},medical:{key:"medical",label:"Atem · Enfermería",image:"/branding/enfermeria.png"},clerk:{key:"clerk",label:"Atem · Secretaría",image:"/branding/direccion.png"}},ys=a=>a?js[a]??P:P,Ns="El sistema transforma tu nombre a mayusculas para que coincida con la plantilla autorizada.",ee={status:"idle"},se=a=>a==="valid"?"input-field input-field--success":a==="error"?"input-field input-field--error":"input-field",te=a=>a==="valid"?e.jsx(ss,{size:18,className:"input-status__icon input-status__icon--valid","aria-hidden":!0}):a==="error"?e.jsx(ts,{size:18,className:"input-status__icon input-status__icon--error","aria-hidden":!0}):null,Ce=(a,t)=>a.status==="error"&&a.message?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"field-feedback field-feedback--error",children:a.message}),t?e.jsx("p",{className:"field-feedback field-feedback--muted",children:t}):null]}):a.status==="valid"&&a.message?e.jsx("p",{className:"field-feedback field-feedback--success",children:a.message}):t?e.jsx("p",{className:"field-feedback field-feedback--muted",children:t}):null,ws=({values:a,submitting:t=!1,serverError:I=null,passwordHint:S,validation:i,canSubmit:f=!0,onChange:p,onSubmit:u,onCancel:b})=>{const g=(i==null?void 0:i.nombreCompleto)??ee,m=(i==null?void 0:i.email)??ee,c=(i==null?void 0:i.password)??ee;return e.jsxs("form",{className:"space-y-4",onSubmit:u,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"register-full-name",children:"Nombre completo"}),e.jsxs("div",{className:"input-status",children:[e.jsx("input",{id:"register-full-name",type:"text",className:se(g.status),placeholder:"Ej. HUGO SANCHEZ RESENDIZ",autoComplete:"name",value:a.nombreCompleto,onChange:j=>p("nombreCompleto",j.target.value.toUpperCase()),disabled:t,required:!0}),te(g.status)]}),Ce(g,Ns)]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"register-email",children:"Correo institucional"}),e.jsxs("div",{className:"input-status",children:[e.jsx("input",{id:"register-email",type:"email",className:se(m.status),placeholder:"usuario@institucion.mx",autoComplete:"email",value:a.email,onChange:j=>p("email",j.target.value),disabled:t,required:!0}),te(m.status)]}),Ce(m,"Usa un correo permitido por la institucion (termina en @institucion.mx o @aefcm.gob.mx).")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"register-password",children:"Contrasena"}),e.jsxs("div",{className:"input-status",children:[e.jsx("input",{id:"register-password",type:"password",className:se(c.status),placeholder:"Debe cumplir los requisitos minimos",autoComplete:"new-password",value:a.password,onChange:j=>p("password",j.target.value),disabled:t,required:!0}),te(c.status)]}),c.status==="valid"&&c.message?e.jsx("p",{className:"field-feedback field-feedback--success",children:c.message}):e.jsxs(e.Fragment,{children:[c.status==="error"&&c.message?e.jsx("p",{className:"field-feedback field-feedback--error",children:c.message}):null,S?e.jsx("p",{className:"field-feedback field-feedback--muted whitespace-pre-line",children:S}):null]})]}),I?e.jsx("p",{className:"text-sm text-red-400",children:I}):null,e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:justify-end",children:[b?e.jsx("button",{type:"button",className:"btn btn-secondary sm:w-auto w-full",onClick:b,disabled:t,children:"Cancelar"}):null,e.jsx("button",{type:"submit",className:"btn btn-primary sm:w-auto w-full",disabled:t||!f,children:t?"Registrando...":"Registrarme"})]})]})},Ss=os(as,"logSensitiveAccess"),vs=async a=>{try{if(!a.resource||a.resource.trim().length===0)throw new Error("Especifica el recurso que deseas consultar.");return(await Ss({resource:a.resource,reason:a.reason??null})).data}catch(t){throw console.error("[SASE-310] No se pudo registrar el acceso sensible:",t),new Error("No fue posible validar la reautenticacion.")}},Es=({isOpen:a,email:t,resource:I,reason:S,onClose:i,onReauthenticated:f})=>{const[p,u]=r.useState(""),[b,g]=r.useState(!1),[m,c]=r.useState(null);if(r.useEffect(()=>{a||(u(""),c(null))},[a]),!a)return null;const j=async v=>{if(v.preventDefault(),c(null),!Se.currentUser){c("No hay una sesion activa para validar.");return}g(!0);try{const o=cs.credential(t,p);await ds(Se.currentUser,o),await vs({resource:I,reason:S}),f(),i()}catch(o){console.error("[SASE-310] Reautenticacion fallida:",o),c(o instanceof Error?o.message:"No fue posible validar la reautenticacion.")}finally{g(!1)}};return e.jsx("div",{className:"reauth-modal__backdrop",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"reauth-modal card",children:[e.jsxs("header",{className:"reauth-modal__header",children:[e.jsx("h2",{className:"text-lg font-display text-white",children:"Confirmar identidad"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Este dato requiere una validacion adicional. Ingresa tu contraseña institucional para continuar."})]}),e.jsxs("form",{className:"space-y-4",onSubmit:j,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"reauth-email",children:"Correo"}),e.jsx("input",{id:"reauth-email",type:"email",className:"input-field w-full",value:t,disabled:!0,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"reauth-password",children:"Contraseña"}),e.jsx("input",{id:"reauth-password",type:"password",className:"input-field w-full",value:p,onChange:v=>u(v.target.value),autoComplete:"current-password",required:!0,minLength:10,disabled:b})]}),m?e.jsx("p",{className:"text-sm text-red-400",children:m}):null,e.jsxs("div",{className:"reauth-modal__actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:i,disabled:b,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:b||p.length===0,children:b?"Validando...":"Confirmar acceso"})]})]})]})})},Re=/@(institucion\.mx|aefcm\.gob\.mx)$/i,Cs="Usa un correo institucional autorizado (termina en @institucion.mx o @aefcm.gob.mx).",Rs=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{10,}$/,As=["- Minimo 10 caracteres.","- Incluye al menos una letra mayuscula.","- Incluye al menos una letra minuscula.","- Incluye al menos un numero."].join(`
`),X="SECUNDARIA 310 PRESIDENTES DE MEXICO",ks=["Seguimiento","Incidencia","Planeacion","Otro"],Ae="teacher",ae=a=>Ee[a??Ae]??Ee[Ae],Z={email:"",password:""},re={nombreCompleto:"",email:"",password:""},ke={title:"",description:"",category:"",date:""},Us=({onNavigateHome:a})=>{const{user:t,loading:I}=rs(),[S,i]=r.useState("chooser"),[f,p]=r.useState(Z),[u,b]=r.useState(re),[g,m]=r.useState(!1),[c,j]=r.useState(!1),[v,o]=r.useState(null),[M,q]=r.useState(null),[l,Q]=r.useState(null),[Le,z]=r.useState(!1),[le,J]=r.useState(null),[x,ne]=r.useState(null),[K,V]=r.useState(!1),[ie,T]=r.useState(null),[O,oe]=r.useState(!1),[Fe,Pe]=r.useState(!1),[Ie,ce]=r.useState(!1),[de,ue]=r.useState([]),[me,pe]=r.useState(!1),[Y,xe]=r.useState(null),[w,he]=r.useState(ke),[fe,G]=r.useState(!1),[be,E]=r.useState(null),[ge,D]=r.useState(null),R=f.email.trim().toLowerCase(),W=u.email.trim().toLowerCase(),je=(l==null?void 0:l.email)??(t==null?void 0:t.email)??"",H=je.length>0,Te=r.useMemo(()=>t?`docentes/${t.uid}`:"docentes/unknown",[t==null?void 0:t.uid]),C=r.useMemo(()=>l!=null&&l.rol?ys(l.rol):P,[l==null?void 0:l.rol]),ye=r.useMemo(()=>W?Re.test(W):!0,[W]),A=r.useMemo(()=>{const s=u.nombreCompleto.trim();return s?s.length<6?{status:"error",message:"Incluye tu nombre y al menos un apellido."}:s.split(/\s+/).length<2?{status:"error",message:"Agrega tus apellidos para validar el registro."}:/^[A-ZÁÉÍÓÚÜÑ\s'.-]+$/i.test(s)?{status:"valid",message:"Nombre listo para validar contra la plantilla autorizada."}:{status:"error",message:"Usa solo letras y espacios en tu nombre."}:{status:"idle",message:"Captura tu nombre completo tal como aparece en la plantilla."}},[u.nombreCompleto]),k=r.useMemo(()=>u.email.trim()?ye?{status:"valid",message:"Correo institucional verificado."}:{status:"error",message:"El correo no pertenece a la institución. Usa una cuenta autorizada."}:{status:"idle",message:Cs},[u.email,ye]),L=r.useMemo(()=>{const s=u.password.trim();return s?Rs.test(s)?{status:"valid",message:"Contrasena segura y lista para usar."}:{status:"error",message:"Incluye 10 caracteres, mayuscula, minuscula y numero."}:{status:"idle",message:"Crea una contrasena segura para tu cuenta."}},[u.password]),De=r.useMemo(()=>({nombreCompleto:A,email:k,password:L}),[A,k,L]),Ue=r.useMemo(()=>A.status==="valid"&&k.status==="valid"&&L.status==="valid",[A.status,k.status,L.status]),F=(l==null?void 0:l.autorizado)===!0,d=g||c||fe||O,y=(s=C,n="md")=>e.jsx("figure",{className:`card-brand card-brand--${n}`,children:e.jsx("img",{src:s.image,alt:s.label})}),U=()=>{o(null),q(null)},B=s=>{i(s),U(),p(Z),b(re),j(!1)},Ne=s=>n=>{U(),p(h=>({...h,[s]:n.target.value}))},_e=(s,n)=>{U();const h=s==="nombreCompleto"?n.toUpperCase():n;b(N=>({...N,[s]:h}))},Me=async s=>{s.preventDefault(),U(),m(!0);try{if(!R||!f.password){o("Completa tu correo y contrasena.");return}const n=await ls(R,f.password);await ps(n.uid,n.email??R),p(Z),i("chooser")}catch(n){console.error("[SASE-310] Login failed:",n),o(n instanceof Error?n.message:"No fue posible iniciar sesion.")}finally{m(!1)}},qe=async()=>{if(o(null),q(null),!R){o("Escribe tu correo institucional para recuperar tu contrasena.");return}if(!Re.test(R)){o("Usa un correo institucional autorizado antes de solicitar el restablecimiento.");return}j(!0);try{await ns(R),q("Te enviamos instrucciones para restablecer tu contrasena. Revisa tu bandeja de entrada.")}catch(s){console.error("[SASE-310] Password reset failed:",s),o(s instanceof Error?s.message:"No pudimos enviar el correo de restablecimiento.")}finally{j(!1)}},ze=async s=>{if(s.preventDefault(),U(),A.status!=="valid"){o(A.message??"Revisa tu nombre completo.");return}if(k.status!=="valid"){o(k.message??"Usa un correo institucional valido.");return}if(L.status!=="valid"){o(L.message??"Completa una contrasena segura.");return}const n=u.nombreCompleto.trim().toUpperCase(),h=u.password.trim();m(!0);try{const{user:N,profile:es}=await xs({nombreCompleto:n,email:W,password:h});await ve(N.uid,{nombre:n,plantel:X}),b(re),q("Registro recibido. Vinculamos tu perfil automaticamente, espera unos segundos."),Q(es),i("chooser")}catch(N){console.error("[SASE-310] Register failed:",N),o(N instanceof Error?N.message:"No fue posible completar el registro.")}finally{m(!1)}},we=async()=>{m(!0);try{await is(),i("chooser"),p(Z),a==null||a()}catch(s){console.error("[SASE-310] Logout failed:",s),o("No fue posible cerrar sesion. Intenta nuevamente.")}finally{m(!1)}},_=r.useCallback(async()=>{if(!t||!F){ue([]);return}pe(!0),xe(null);try{const s=await hs(t.uid);ue(s)}catch(s){console.error("[SASE-310] Failed to fetch reports:",s),xe("No fue posible cargar los reportes.")}finally{pe(!1)}},[t,F]);r.useEffect(()=>{_()},[_]),r.useEffect(()=>{if(!t){Q(null),z(!1),J(null);return}z(!0),J(null);const s=us(t.uid,n=>{Q(n),z(!1)},n=>{console.error("[SASE-310] observeUserProfile error:",n),J("No fue posible cargar tu perfil docente."),z(!1)});return()=>{s()}},[t]),r.useEffect(()=>{if(!l||F)return;const s=window.setTimeout(()=>{a==null||a(),i("chooser")},4e3);return()=>window.clearTimeout(s)},[l,F,a]),r.useEffect(()=>{if(!t){ne(null),V(!1),T(null);return}V(!0),T(null);const s=ms(t.uid,n=>{ne(n),V(!1)},n=>{console.error("[SASE-310] observeTeacherProfile error:",n),T("No fue posible cargar tus datos docentes."),V(!1)});return()=>{s()}},[t]),r.useEffect(()=>{var n,h;if(!t||!l||x||K||O)return;const s=((n=l.nombreCompleto)==null?void 0:n.trim().toUpperCase())??((h=l.email)==null?void 0:h.toUpperCase())??"DOCENTE";oe(!0),T(null),ve(t.uid,{nombre:s,plantel:X}).catch(N=>{console.error("[SASE-310] Auto save teacher profile failed:",N),T("No pudimos vincular tus datos docentes automaticamente.")}).finally(()=>{oe(!1)})},[t,l,x,K,O]);const $=s=>n=>{E(null),D(null),he(h=>({...h,[s]:n.target.value}))},Ve=async s=>{if(s.preventDefault(),!t){E("Debes iniciar sesion para crear un reporte.");return}if(!F){E("Tu cuenta aun no ha sido autorizada.");return}G(!0),E(null),D(null);try{const n={title:w.title.trim(),description:w.description.trim(),category:w.category.trim(),date:w.date.trim(),uid:t.uid},h={name:(l==null?void 0:l.nombreCompleto)??(x==null?void 0:x.nombre)??null,email:t.email??null,role:(l==null?void 0:l.rol)??null};await fs(n,h),he({...ke,category:n.category}),D("Reporte creado correctamente."),await _()}catch(n){console.error("[SASE-310] Create report failed:",n),E(n instanceof Error?n.message:"No fue posible crear el reporte.")}finally{G(!1)}},Oe=async s=>{G(!0),E(null),D(null);try{await bs(s),D("Reporte eliminado."),await _()}catch(n){console.error("[SASE-310] Delete report failed:",n),E("No fue posible eliminar el reporte.")}finally{G(!1)}},Ge=()=>e.jsxs("section",{className:"card space-y-4",children:[y(P),e.jsxs("header",{children:[e.jsx("h2",{className:"text-xl font-display text-white",children:"SASE-310 Piloto"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Elige como deseas continuar."})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:gap-4",children:[e.jsx("button",{type:"button",className:"btn btn-primary w-full",onClick:()=>B("login"),disabled:d,children:"Ingresar con correo y contrasena"}),e.jsx("button",{type:"button",className:"btn btn-secondary w-full",onClick:()=>B("register"),disabled:d,children:"Registrate"})]})]}),We=()=>e.jsxs("section",{className:"card space-y-4",children:[y(P),e.jsxs("header",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-display text-white",children:"Ingresar"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Usa tu correo institucional u oficial. Si no tienes cuenta, vuelve y elige la opcion de registro."})]}),e.jsxs("form",{onSubmit:Me,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"login-email",children:"Correo"}),e.jsx("input",{id:"login-email",type:"email",className:"input-field w-full",placeholder:"ej. docente@aefcm.gob.mx",value:f.email,onChange:Ne("email"),disabled:d,required:!0,autoComplete:"email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"login-password",children:"Contrasena"}),e.jsx("input",{id:"login-password",type:"password",className:"input-field w-full",placeholder:"Tu contrasena",value:f.password,onChange:Ne("password"),disabled:d,required:!0,autoComplete:"current-password"})]}),v?e.jsx("p",{className:"text-sm text-red-400",children:v}):null,M?e.jsx("p",{className:"text-sm text-emerald-400",children:M}):null,e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsx("button",{type:"button",className:"btn btn-secondary md:w-auto w-full",onClick:()=>B("chooser"),children:"Volver"}),e.jsx("button",{type:"submit",className:"btn btn-primary md:w-auto w-full",disabled:d||!f.email||!f.password,children:g?"Ingresando...":"Ingresar"})]}),e.jsx("button",{type:"button",className:"link-button md:self-end",onClick:qe,disabled:c||d,children:c?"Enviando instrucciones...":"¿Olvidaste tu contrasena?"})]})]}),Be=()=>e.jsxs("section",{className:"card space-y-5",children:[y(P),e.jsxs("header",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-display text-white",children:"Registro con lista blanca"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Validamos tu nombre contra la plantilla autorizada. Si coincide y no se ha usado, tu cuenta queda activa de inmediato."})]}),e.jsx(ws,{values:u,submitting:g,serverError:v,passwordHint:As,validation:De,canSubmit:Ue,onChange:_e,onSubmit:ze,onCancel:()=>B("chooser")}),M?e.jsx("p",{className:"text-sm text-emerald-400",children:M}):null,e.jsxs("p",{className:"text-xs text-gray-500",children:["La lista blanca se gestiona desde Firestore. Cada docente cuenta con un unico acceso asignado y se vincula automaticamente al plantel ",X,"."]})]}),$e=()=>e.jsx("section",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[y(C,"sm"),e.jsx("p",{className:"text-sm text-gray-400",children:"Validando permisos docentes..."})]})}),Xe=()=>e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[y(C,"sm"),e.jsx("h3",{className:"text-lg font-display mb-2",children:"No fue posible cargar tu perfil docente"}),e.jsx("p",{className:"text-sm text-red-400",children:le}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Intenta cerrar sesion y volver a ingresar."})]}),e.jsxs("div",{className:"card flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Puedes volver al menu principal si lo prefieres."}),e.jsx("button",{type:"button",className:"btn btn-secondary md:w-auto w-full",onClick:we,disabled:d,children:"Cerrar sesion"})]})]}),Ze=()=>e.jsx("section",{className:"space-y-6",children:e.jsxs("div",{className:"card space-y-3",children:[y(C,"sm"),e.jsx("h3",{className:"text-lg font-display text-white",children:"Registrando datos docentes..."}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Estamos vinculando tu perfil con el plantel ",X,". Este paso ocurre automaticamente la primera vez que ingresas."]}),O?e.jsx("p",{className:"text-sm text-gray-400",children:"Guardando informacion..."}):null,ie?e.jsx("p",{className:"text-sm text-red-400",children:ie}):e.jsx("p",{className:"text-xs text-gray-500",children:"Puedes permanecer en esta pantalla; en segundos te mostraremos el modulo cuando la sincronizacion finalice."})]})}),Qe=()=>e.jsxs("section",{className:"card space-y-4",children:[y(C),e.jsx("h3",{className:"text-lg font-display text-white",children:"Preregistro recibido"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tu cuenta esta en validacion. Te avisaremos al correo cuando puedas ingresar al modulo."}),e.jsxs("div",{className:"rounded-md border border-gray-800 bg-black/20 p-3 text-xs text-gray-300 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Correo:"})," ",(t==null?void 0:t.email)??"Sin correo"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Rol asignado:"})," ",ae(l==null?void 0:l.rol)]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Te enviaremos un aviso cuando la cuenta este autorizada. Esta ventana se cerrara automaticamente."})]}),Je=()=>e.jsxs("section",{className:"card space-y-4",children:[e.jsx("div",{className:"flex justify-center md:justify-end",children:y(C,"sm")}),e.jsxs("header",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-display text-white",children:"Datos protegidos"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Confirma tu contrasena institucional para consultar los datos asociados a tu perfil docente."})]}),Fe?e.jsxs("dl",{className:"space-y-2 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("dt",{className:"font-semibold text-white",children:"Plantel asignado"}),e.jsx("dd",{children:(x==null?void 0:x.plantel)??"Sin registro"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("dt",{className:"font-semibold text-white",children:"Nombre oficial"}),e.jsx("dd",{children:(l==null?void 0:l.nombreCompleto)??(x==null?void 0:x.nombre)??"Sin registro"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("dt",{className:"font-semibold text-white",children:"Correo institucional"}),e.jsx("dd",{children:(l==null?void 0:l.email)??t.email??"Sin correo"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("dt",{className:"font-semibold text-white",children:"Rol operativo"}),e.jsx("dd",{children:ae(l==null?void 0:l.rol)})]})]}):e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex-1 text-sm text-gray-400",children:["La informacion sensible permanece oculta hasta validar tu identidad.",H?null:e.jsx("p",{className:"mt-2 text-xs text-yellow-400",children:"No detectamos un correo institucional vinculado. Solicita asistencia al administrador."})]}),e.jsx("button",{type:"button",className:"btn btn-secondary sm:w-auto w-full",onClick:()=>ce(!0),disabled:d||!H,children:"Desbloquear datos sensibles"})]})]}),Ke=()=>e.jsxs("header",{className:"card flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:gap-4",children:[y(C,"sm"),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-display text-[var(--accent-1)]",children:"SASE-310 Reportes"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Gestiona reportes vinculados a tu cuenta docente."})]})]}),e.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("span",{className:"font-semibold text-white",children:(t==null?void 0:t.email)??"Sin correo"}),e.jsxs("span",{className:"block text-xs text-gray-500",children:["Rol: ",ae(l==null?void 0:l.rol)]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:we,disabled:d,children:g?"Cerrando sesion...":"Cerrar sesion"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{a==null||a()},disabled:d,children:"Volver al menu"})]})]})]}),Ye=()=>e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-display mb-4",children:"Crear nuevo reporte"}),e.jsxs("form",{onSubmit:Ve,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"report-title",children:"Titulo"}),e.jsx("input",{id:"report-title",type:"text",className:"input-field w-full",placeholder:"Ej. Seguimiento de clase",value:w.title,onChange:$("title"),disabled:d,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"report-description",children:"Descripcion"}),e.jsx("textarea",{id:"report-description",className:"input-field w-full h-32",placeholder:"Describe la situacion o seguimiento",value:w.description,onChange:$("description"),disabled:d,required:!0})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"report-category",children:"Categoria"}),e.jsxs("select",{id:"report-category",className:"input-field w-full",value:w.category,onChange:$("category"),disabled:d,required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoria"}),ks.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-gray-300",htmlFor:"report-date",children:"Fecha"}),e.jsx("input",{id:"report-date",type:"date",className:"input-field w-full",value:w.date,onChange:$("date"),disabled:d,required:!0})]})]}),be?e.jsx("p",{className:"text-sm text-red-400",children:be}):null,ge?e.jsx("p",{className:"text-sm text-emerald-400",children:ge}):null,e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:d,children:fe?"Guardando...":"Guardar reporte"})]})]}),He=()=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-display",children:"Historial de reportes"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>void _(),disabled:d,children:"Recargar"})]}),me?e.jsx("p",{className:"text-sm text-gray-400",children:"Cargando reportes..."}):null,Y?e.jsx("p",{className:"text-sm text-red-400",children:Y}):null,!me&&de.length===0&&!Y?e.jsx("p",{className:"text-sm text-gray-400",children:"Aun no has registrado reportes."}):null,e.jsx("ul",{className:"space-y-3",children:de.map(s=>e.jsxs("li",{className:"bg-black/30 border border-gray-800 rounded-lg p-3",children:[e.jsxs("header",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-semibold text-white",children:s.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Creado: ",s.createdAt.toDate().toLocaleString()," | Ultima actualizacion:"," ",s.updatedAt.toDate().toLocaleString()]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Categoria: ",s.category," | Fecha de aplicacion: ",s.date.toDate().toLocaleDateString()]})]}),e.jsx("button",{type:"button",className:"btn btn-secondary text-xs px-2 py-1",onClick:()=>void Oe(s.id),disabled:d,children:"Eliminar"})]}),e.jsx("p",{className:"text-sm text-gray-200 mt-2 whitespace-pre-wrap",children:s.description})]},s.id))})]});return t?Le||K?$e():le?Xe():x?F?e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-6",children:[Ke(),Je(),Ye(),He()]}),e.jsx(Es,{isOpen:Ie&&H,onClose:()=>ce(!1),onReauthenticated:()=>Pe(!0),email:je,resource:Te,reason:"Consulta de datos sensibles del perfil docente"})]}):Qe():Ze():S==="login"?We():S==="register"?Be():Ge()};export{Us as default};
