import{r as o,j as s}from"./react-vendor-BfikQoQB.js";import{g as S,a as A}from"./userService-QFZnPS6u.js";import"./vendor-CUhUAKZ9.js";import"./firebase-Bi_eiI5S.js";import"./index-CGsLMNMp.js";const C=()=>{const[a,l]=o.useState([]),[c,d]=o.useState(!0),[h,m]=o.useState(null),i=o.useCallback(async()=>{d(!0),m(null);try{const t=await S();l(t)}catch(t){console.error("[Auth2.0] No fue posible cargar los usuarios pendientes:",t),m(t instanceof Error?t.message:"No se pudieron obtener los usuarios pendientes.")}finally{d(!1)}},[]);o.useEffect(()=>{i()},[i]);const x=o.useCallback(async(t,g)=>{try{await A(t,g),await i()}catch(u){throw console.error("[Auth2.0] No fue posible aprobar al usuario:",u),m(u instanceof Error?u.message:"Ocurrio un error al aprobar al usuario."),u}},[i]);return{pending:a,loading:c,error:h,approve:x,refresh:i}},p=[{value:"teacher",label:"Docente"},{value:"guidance",label:"Orientacion"},{value:"prefect",label:"Prefectura"},{value:"medical",label:"Servicio Medico"},{value:"socialWork",label:"Trabajo Social"},{value:"clerk",label:"Secretaria"}],P=a=>{if(a==="admin")return"Direccion";const l=p.find(c=>c.value===a);return(l==null?void 0:l.label)??a},R=a=>a.rol==="admin"?"teacher":p.some(l=>l.value===a.rol)?a.rol:"teacher",D=({onRefreshRequested:a})=>{const{pending:l,loading:c,error:d,approve:h,refresh:m}=C(),[i,x]=o.useState({}),[t,g]=o.useState(null),[u,b]=o.useState(null),f=(e,n)=>{x(r=>({...r,[e]:n}))},j=e=>i[e.id]??R(e),N=async e=>{const n=j(e);g(e.id),b(null);try{await h(e.id,n),b(`Usuario ${e.email} aprobado como ${P(n)}.`),x(r=>{const y={...r};return delete y[e.id],y}),a==null||a()}catch(r){console.error("[AdminPanel] Error al aprobar usuario:",r)}finally{g(null)}},w=async()=>{b(null),await m()},v=o.useMemo(()=>l.slice().sort((e,n)=>e.fechaRegistro&&n.fechaRegistro?n.fechaRegistro.toMillis()-e.fechaRegistro.toMillis():e.email.localeCompare(n.email)),[l]);return s.jsxs("section",{className:"space-y-6",children:[s.jsxs("header",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-display text-white",children:"Panel de aprobaciÃ³n"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Autoriza cuentas docentes y asigna el rol operativo correspondiente."})]}),s.jsx("button",{type:"button",className:"btn btn-secondary sm:w-auto w-full",onClick:w,disabled:c,children:c?"Actualizando...":"Actualizar lista"})]}),d?s.jsx("p",{className:"text-sm text-red-400",children:d}):null,u?s.jsx("p",{className:"text-sm text-emerald-400",children:u}):null,s.jsxs("div",{className:"card",children:[c?s.jsx("p",{className:"text-sm text-gray-400",children:"Cargando usuarios pendientes..."}):null,!c&&v.length===0?s.jsx("p",{className:"text-sm text-gray-400",children:"No hay usuarios pendientes por autorizar."}):null,s.jsx("ul",{className:"space-y-4",children:v.map(e=>{const n=j(e);return s.jsx("li",{className:"bg-black/30 border border-gray-800 rounded-lg p-4",children:s.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-base font-semibold text-white",children:e.nombreCompleto}),s.jsx("p",{className:"text-sm text-gray-400",children:e.email}),e.fechaRegistro?s.jsxs("p",{className:"text-xs text-gray-500",children:["Registrado: ",e.fechaRegistro.toDate().toLocaleString()]}):null]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:items-center",children:[s.jsxs("label",{className:"text-sm text-gray-300",children:["Rol asignado",s.jsx("select",{className:"input-field mt-1 w-full",value:n,onChange:r=>f(e.id,r.target.value),disabled:t===e.id,children:p.map(r=>s.jsx("option",{value:r.value,children:r.label},r.value))})]}),s.jsx("button",{type:"button",className:"btn btn-primary sm:w-auto w-full",onClick:()=>void N(e),disabled:t===e.id,children:t===e.id?"Aprobando...":"Aprobar"})]})]})},e.id)})})]})]})};export{D as AdminPanel,D as default};
