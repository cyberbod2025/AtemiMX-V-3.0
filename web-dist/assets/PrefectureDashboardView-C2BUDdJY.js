import{r as o,j as e}from"./react-vendor-BfikQoQB.js";import{R as y,g as w}from"./ReportForm-CX2MNRaP.js";import{R}from"./ReportCard-DRFuh_XI.js";import{D as v,C as D,E as C,a as I,n as k,M as A}from"./AtemiDashboard-B3V7Tu8X.js";import{R as S,B as T,d as E,X as P,Y as B,T as M,e as F}from"./vendor-CUhUAKZ9.js";import"./geminiService-CvMJKX3O.js";import"./firestoreService-CgKjpCo_.js";import"./firebase-Bi_eiI5S.js";import"./index-CZdUSK2y.js";const q=({currentUser:c,viewStudentProfile:f})=>{const[i,l]=o.useState([]),[m,h]=o.useState(!1),u=async()=>{const n=(await w()).filter(r=>r.type===k.Attendance);l(n.sort((r,g)=>new Date(g.date).getTime()-new Date(r.date).getTime()))};o.useEffect(()=>{u()},[c.id]);const j=s=>{l(n=>[s,...n]),h(!1),u()},b=s=>{l(n=>n.map(r=>r.id===s.id?s:r))},p=s=>{if(s.studentName)return{id:s.studentId,name:s.studentName,grade:"",group:""};const n=A.find(r=>r.id===s.studentId);return n||{id:s.studentId,name:s.studentId,grade:"N/A",group:""}},x=o.useMemo(()=>{const s=i.reduce((t,a)=>{const d=p(a).grade||"N/A";return t[d]=(t[d]||0)+1,t},{}),n=Object.entries(s).map(([t,a])=>({name:t,value:a})).sort((t,a)=>t.name.localeCompare(a.name)),r=i.reduce((t,a)=>{const d=p(a).name||"Desconocido";return t[d]=(t[d]||0)+1,t},{}),N=Object.entries(r).map(([t,a])=>({name:t,value:a})).sort((t,a)=>a.value-t.value).filter(t=>t.value>1);return{gradeData:n,reincidences:N}},[i]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Panel de Prefectura"}),e.jsxs("button",{onClick:()=>h(!m),className:"flex items-center bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-blue-700 transition-colors",children:[e.jsx(v,{className:"h-5 w-5 mr-2"}),m?"Cancelar":"Registrar Incidencia"]})]}),m&&e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg animate-fade-in-down",children:e.jsx(y,{currentUser:c,onReportSubmit:j})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow h-80",children:[e.jsxs("h4",{className:"font-semibold mb-2 text-center flex items-center justify-center",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),"Incidencias de Asistencia por Grado"]}),e.jsx(S,{width:"100%",height:"90%",children:e.jsxs(T,{data:x.gradeData,children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"name"}),e.jsx(B,{allowDecimals:!1}),e.jsx(M,{}),e.jsx(F,{dataKey:"value",fill:"#8884d8",name:"Incidencias"})]})})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow h-80",children:[e.jsxs("h4",{className:"font-semibold mb-2 text-center flex items-center justify-center text-red-600 dark:text-red-400",children:[e.jsx(C,{className:"h-5 w-5 mr-2"}),"Alumnos con Reincidencias"]}),x.reincidences.length>0?e.jsx("ul",{className:"space-y-2 overflow-y-auto max-h-64",children:x.reincidences.map(s=>e.jsxs("li",{className:"flex justify-between items-center p-2 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"font-bold text-red-500",children:[s.value," incidencias"]})]},s.name))}):e.jsx("p",{className:"text-center text-gray-500 pt-10",children:"No hay alumnos con reincidencias."})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold flex items-center mb-4 text-gray-700 dark:text-gray-300",children:[e.jsx(I,{className:"h-6 w-6 mr-2"}),"Historial de Asistencia"]}),e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsx(R,{report:s,viewStudentProfile:f,onReportUpdate:b,currentUser:c},s.id))})]})]})};export{q as default};
