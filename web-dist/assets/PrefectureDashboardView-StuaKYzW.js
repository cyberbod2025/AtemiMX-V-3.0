import{r as c,f as g,j as e,D as R,C as v,E as D,a as C,b as k,o as A}from"./index-J06LgYwp.js";import{R as I}from"./ReportForm-CftKmYLq.js";import{R as S}from"./ReportCard-BBi0SBXQ.js";import{R as T,T as E}from"./CategoricalChart-CVOWy7Az.js";import{B,C as P,X as F,Y as G,a as K}from"./BarChart-bQUJg7Tb.js";import"./geminiService-fkZN5fdV.js";const V=({currentUser:l,viewStudentProfile:b})=>{const[o,m]=c.useState([]),[x,u]=c.useState(!1),f=async()=>{const r=(await k()).filter(n=>n.type===A.Attendance);m(r.sort((n,j)=>new Date(j.date).getTime()-new Date(n.date).getTime()))};c.useEffect(()=>{f()},[l.id]);const y=a=>{m(r=>[a,...r]),u(!1),f()},w=a=>{m(r=>r.map(n=>n.id===a.id?a:n))},h=c.useMemo(()=>{const a=o.reduce((s,t)=>{var d;const i=((d=g.find(p=>p.id===t.studentId))==null?void 0:d.grade)||"N/A";return s[i]=(s[i]||0)+1,s},{}),r=Object.entries(a).map(([s,t])=>({name:s,value:t})).sort((s,t)=>s.name.localeCompare(t.name)),n=o.reduce((s,t)=>{var d;const i=((d=g.find(p=>p.id===t.studentId))==null?void 0:d.name)||"Desconocido";return s[i]=(s[i]||0)+1,s},{}),N=Object.entries(n).map(([s,t])=>({name:s,value:t})).sort((s,t)=>t.value-s.value).filter(s=>s.value>1);return{gradeData:r,reincidences:N}},[o]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Panel de Prefectura"}),e.jsxs("button",{onClick:()=>u(!x),className:"flex items-center bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-blue-700 transition-colors",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),x?"Cancelar":"Registrar Incidencia"]})]}),x&&e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg animate-fade-in-down",children:e.jsx(I,{currentUser:l,onReportSubmit:y})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow h-80",children:[e.jsxs("h4",{className:"font-semibold mb-2 text-center flex items-center justify-center",children:[e.jsx(v,{className:"h-5 w-5 mr-2"}),"Incidencias de Asistencia por Grado"]}),e.jsx(T,{width:"100%",height:"90%",children:e.jsxs(B,{data:h.gradeData,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name"}),e.jsx(G,{allowDecimals:!1}),e.jsx(E,{}),e.jsx(K,{dataKey:"value",fill:"#8884d8",name:"Incidencias"})]})})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow h-80",children:[e.jsxs("h4",{className:"font-semibold mb-2 text-center flex items-center justify-center text-red-600 dark:text-red-400",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),"Alumnos con Reincidencias"]}),h.reincidences.length>0?e.jsx("ul",{className:"space-y-2 overflow-y-auto max-h-64",children:h.reincidences.map(a=>e.jsxs("li",{className:"flex justify-between items-center p-2 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx("span",{className:"font-medium",children:a.name}),e.jsxs("span",{className:"font-bold text-red-500",children:[a.value," incidencias"]})]},a.name))}):e.jsx("p",{className:"text-center text-gray-500 pt-10",children:"No hay alumnos con reincidencias."})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold flex items-center mb-4 text-gray-700 dark:text-gray-300",children:[e.jsx(C,{className:"h-6 w-6 mr-2"}),"Historial de Asistencia"]}),e.jsx("div",{className:"space-y-4",children:o.map(a=>e.jsx(S,{report:a,viewStudentProfile:b,onReportUpdate:w,currentUser:l},a.id))})]})]})};export{V as default};
