import{G as b,M as w}from"./vendor-mpNZlVBn.js";function v(o){let n="";const t=o.byteLength;for(let e=0;e<t;e++)n+=String.fromCharCode(o[e]);return btoa(n)}function A(o){const n=o.length,t=new Int16Array(n);for(let e=0;e<n;e++)t[e]=o[e]*32768;return{data:v(new Uint8Array(t.buffer)),mimeType:"audio/pcm;rate=16000"}}const C=o=>new Promise((n,t)=>{const e=new FileReader;e.onloadend=()=>{const i=e.result.split(",")[1];i?n(i):t(new Error("Failed to convert blob to base64."))},e.onerror=i=>t(i),e.readAsDataURL(o)});var g={};const u=g.API_KEY;if(!u)throw new Error("API_KEY environment variable not set");const d=new b({apiKey:u}),P=async(o,n)=>{try{const t={inlineData:{data:o,mimeType:n}};return(await d.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[t,{text:"Transcribe este audio."}]}})).text}catch(t){return console.error("Error transcribing audio:",t),""}};let a=null,r=null,s=null,c=null;const I=async({onMessage:o,onError:n,onClose:t,stream:e})=>{a&&(console.warn("An active session already exists. Closing the old one."),h(Promise.resolve(a))),r=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});const i=d.live.connect({model:"gemini-2.5-flash-native-audio-preview-09-2025",callbacks:{onopen:()=>{c=r.createMediaStreamSource(e),s=r.createScriptProcessor(4096,1,1),s.onaudioprocess=p=>{const m=p.inputBuffer.getChannelData(0),f=A(m);i.then(l=>{l&&l.sendRealtimeInput({media:f})})},c.connect(s),s.connect(r.destination)},onmessage:o,onerror:n,onclose:t},config:{responseModalities:[w.AUDIO],outputAudioTranscription:{},inputAudioTranscription:{},systemInstruction:"Eres un asistente de IA para personal escolar. SÃ© conciso, profesional y servicial."}});return a=await i,a},h=o=>{o.then(n=>{n&&n.close(),s&&(s.disconnect(),s=null),c&&(c.disconnect(),c=null),r&&r.state!=="closed"&&(r.close(),r=null),a=null})};export{C as b,h as c,I as s,P as t};
