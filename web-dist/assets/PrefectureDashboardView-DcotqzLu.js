import{t as N,f as R,R as D,e as v,u as o,r as m,j as e,D as k,C as A,E as C,b as S,M as I}from"./index-CuykJsXK.js";import{R as E}from"./ReportForm-BTVDkWMz.js";import{R as T}from"./ReportCard-D4P4pzdn.js";import{R as P,T as M}from"./CategoricalChart-CQIJYn4j.js";import{B as O,C as B,X as F,Y as G,a as K}from"./BarChart-BP6rETGf.js";import"./geminiService-fkZN5fdV.js";const Y={disciplina:o.Disciplinary,disciplinario:o.Disciplinary,socioemocional:o.SocioEmotional,"socio-emocional":o.SocioEmotional,academico:o.Academic,acadÃ©mico:o.Academic,asistencia:o.Attendance},X=s=>{const d=s.trim().toLowerCase();return Y[d]??o.Disciplinary},_=s=>({id:s.id,studentId:s.ownerEmail??s.ownerName??"sin-asignar",teacherId:s.uid,date:s.date.toDate().toISOString(),type:X(s.category),subject:s.title,description:s.description,status:D.InProgress,priority:R.Medium,actionsTaken:s.description,comments:[],evidence:[]}),z=async()=>{try{return(await N()).map(_)}catch(s){return console.error("[Dashboard] Falling back to mock reports set",s),await v()}},J=({currentUser:s,viewStudentProfile:d})=>{const[l,x]=m.useState([]),[h,u]=m.useState(!1),g=async()=>{const r=(await z()).filter(i=>i.type===o.Attendance);x(r.sort((i,j)=>new Date(j.date).getTime()-new Date(i.date).getTime()))};m.useEffect(()=>{g()},[s.id]);const b=a=>{x(r=>[a,...r]),u(!1),g()},y=a=>{x(r=>r.map(i=>i.id===a.id?a:i))},f=a=>{const r=I.find(i=>i.id===a);return r||{id:a,name:a,grade:"N/A",group:""}},p=m.useMemo(()=>{const a=l.reduce((t,n)=>{const c=f(n.studentId).grade||"N/A";return t[c]=(t[c]||0)+1,t},{}),r=Object.entries(a).map(([t,n])=>({name:t,value:n})).sort((t,n)=>t.name.localeCompare(n.name)),i=l.reduce((t,n)=>{const c=f(n.studentId).name||"Desconocido";return t[c]=(t[c]||0)+1,t},{}),w=Object.entries(i).map(([t,n])=>({name:t,value:n})).sort((t,n)=>n.value-t.value).filter(t=>t.value>1);return{gradeData:r,reincidences:w}},[l]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Panel de Prefectura"}),e.jsxs("button",{onClick:()=>u(!h),className:"flex items-center bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-blue-700 transition-colors",children:[e.jsx(k,{className:"h-5 w-5 mr-2"}),h?"Cancelar":"Registrar Incidencia"]})]}),h&&e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg animate-fade-in-down",children:e.jsx(E,{currentUser:s,onReportSubmit:b})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow h-80",children:[e.jsxs("h4",{className:"font-semibold mb-2 text-center flex items-center justify-center",children:[e.jsx(A,{className:"h-5 w-5 mr-2"}),"Incidencias de Asistencia por Grado"]}),e.jsx(P,{width:"100%",height:"90%",children:e.jsxs(O,{data:p.gradeData,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name"}),e.jsx(G,{allowDecimals:!1}),e.jsx(M,{}),e.jsx(K,{dataKey:"value",fill:"#8884d8",name:"Incidencias"})]})})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow h-80",children:[e.jsxs("h4",{className:"font-semibold mb-2 text-center flex items-center justify-center text-red-600 dark:text-red-400",children:[e.jsx(C,{className:"h-5 w-5 mr-2"}),"Alumnos con Reincidencias"]}),p.reincidences.length>0?e.jsx("ul",{className:"space-y-2 overflow-y-auto max-h-64",children:p.reincidences.map(a=>e.jsxs("li",{className:"flex justify-between items-center p-2 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx("span",{className:"font-medium",children:a.name}),e.jsxs("span",{className:"font-bold text-red-500",children:[a.value," incidencias"]})]},a.name))}):e.jsx("p",{className:"text-center text-gray-500 pt-10",children:"No hay alumnos con reincidencias."})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold flex items-center mb-4 text-gray-700 dark:text-gray-300",children:[e.jsx(S,{className:"h-6 w-6 mr-2"}),"Historial de Asistencia"]}),e.jsx("div",{className:"space-y-4",children:l.map(a=>e.jsx(T,{report:a,viewStudentProfile:d,onReportUpdate:y,currentUser:s},a.id))})]})]})};export{J as default};
