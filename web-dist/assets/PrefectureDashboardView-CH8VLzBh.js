import{r as c,j as e,D as y,C as w,E as R,i as v,B as D,M as C}from"./index-B93U3tDT.js";import{R as I,g as k}from"./ReportForm-DF3a5ZuU.js";import{R as A}from"./ReportCard-C8iLMip1.js";import{R as S,T}from"./CategoricalChart-B_SJ7qfj.js";import{B as E,C as B,X as P,Y as M,a as F}from"./BarChart-DCu2wRjz.js";import"./geminiService-fkZN5fdV.js";const U=({currentUser:o,viewStudentProfile:f})=>{const[i,l]=c.useState([]),[m,h]=c.useState(!1),u=async()=>{const n=(await k()).filter(r=>r.type===D.Attendance);l(n.sort((r,g)=>new Date(g.date).getTime()-new Date(r.date).getTime()))};c.useEffect(()=>{u()},[o.id]);const j=s=>{l(n=>[s,...n]),h(!1),u()},b=s=>{l(n=>n.map(r=>r.id===s.id?s:r))},p=s=>{if(s.studentName)return{id:s.studentId,name:s.studentName,grade:"",group:""};const n=C.find(r=>r.id===s.studentId);return n||{id:s.studentId,name:s.studentId,grade:"N/A",group:""}},x=c.useMemo(()=>{const s=i.reduce((a,t)=>{const d=p(t).grade||"N/A";return a[d]=(a[d]||0)+1,a},{}),n=Object.entries(s).map(([a,t])=>({name:a,value:t})).sort((a,t)=>a.name.localeCompare(t.name)),r=i.reduce((a,t)=>{const d=p(t).name||"Desconocido";return a[d]=(a[d]||0)+1,a},{}),N=Object.entries(r).map(([a,t])=>({name:a,value:t})).sort((a,t)=>t.value-a.value).filter(a=>a.value>1);return{gradeData:n,reincidences:N}},[i]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Panel de Prefectura"}),e.jsxs("button",{onClick:()=>h(!m),className:"flex items-center bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-blue-700 transition-colors",children:[e.jsx(y,{className:"h-5 w-5 mr-2"}),m?"Cancelar":"Registrar Incidencia"]})]}),m&&e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg animate-fade-in-down",children:e.jsx(I,{currentUser:o,onReportSubmit:j})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow h-80",children:[e.jsxs("h4",{className:"font-semibold mb-2 text-center flex items-center justify-center",children:[e.jsx(w,{className:"h-5 w-5 mr-2"}),"Incidencias de Asistencia por Grado"]}),e.jsx(S,{width:"100%",height:"90%",children:e.jsxs(E,{data:x.gradeData,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"name"}),e.jsx(M,{allowDecimals:!1}),e.jsx(T,{}),e.jsx(F,{dataKey:"value",fill:"#8884d8",name:"Incidencias"})]})})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow h-80",children:[e.jsxs("h4",{className:"font-semibold mb-2 text-center flex items-center justify-center text-red-600 dark:text-red-400",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Alumnos con Reincidencias"]}),x.reincidences.length>0?e.jsx("ul",{className:"space-y-2 overflow-y-auto max-h-64",children:x.reincidences.map(s=>e.jsxs("li",{className:"flex justify-between items-center p-2 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"font-bold text-red-500",children:[s.value," incidencias"]})]},s.name))}):e.jsx("p",{className:"text-center text-gray-500 pt-10",children:"No hay alumnos con reincidencias."})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold flex items-center mb-4 text-gray-700 dark:text-gray-300",children:[e.jsx(v,{className:"h-6 w-6 mr-2"}),"Historial de Asistencia"]}),e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsx(A,{report:s,viewStudentProfile:f,onReportUpdate:b,currentUser:o},s.id))})]})]})};export{U as default};
