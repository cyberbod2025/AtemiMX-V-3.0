# =====================================================
# üîç Validaci√≥n de Integridad ‚Äì Auth 2.0 / AtemiMX v3.5
# Autor: Profe Hugo S√°nchez Res√©ndiz
# Objetivo: Confirmar que las reglas Firestore, roles y hooks
# funcionan correctamente antes del despliegue.
# =====================================================

Write-Host "üß© Iniciando validaci√≥n local de Auth 2.0 (AtemiMX v3.5)..." -ForegroundColor Cyan

# 1Ô∏è‚É£ Verificar estructura de archivos
$paths = @(
    "modules\sase310\auth\components\LoginForm.tsx",
    "modules\sase310\auth\components\RegisterForm.tsx",
    "modules\sase310\auth\components\AdminPanel.tsx",
    "modules\sase310\auth\hooks\useAuthAdmin.ts",
    "modules\sase310\auth\services\userService.ts",
    "modules\sase310\firestore.rules"
)

$missing = @()
foreach ($path in $paths) {
    if (-not (Test-Path $path)) {
        $missing += $path
    }
}

if ($missing.Count -gt 0) {
    Write-Host "‚ö†Ô∏è Archivos faltantes detectados:" -ForegroundColor Yellow
    $missing | ForEach-Object { Write-Host " - $_" }
} else {
    Write-Host "‚úÖ Todos los archivos requeridos est√°n presentes." -ForegroundColor Green
}

# 2Ô∏è‚É£ Verificar palabra clave de seguridad en firestore.rules
$rulesContent = Get-Content "modules\sase310\firestore.rules" -Raw
if ($rulesContent -match "request\.auth\.uid == uid") {
    Write-Host "‚úÖ Reglas Firestore corregidas detectadas." -ForegroundColor Green
} else {
    Write-Host "‚ùå Reglas Firestore NO corregidas. Revise 'allow read'." -ForegroundColor Red
}

# 3Ô∏è‚É£ Validar presencia de selector de roles en AdminPanel.tsx
$adminContent = Get-Content "modules\sase310\auth\components\AdminPanel.tsx" -Raw
